{"ast":null,"code":"import _asyncToGenerator from\"/Users/shikharmishra/Documents/Mishra-Messenger/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/shikharmishra/Documents/Mishra-Messenger/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/shikharmishra/Documents/Mishra-Messenger/frontend/node_modules/@babel/runtime/regenerator/index.js\";import{ViewIcon}from\"@chakra-ui/icons\";import{Modal,ModalOverlay,ModalContent,ModalHeader,ModalFooter,ModalBody,ModalCloseButton,Button,useDisclosure,FormControl,Input,useToast,Box,IconButton,Spinner}from\"@chakra-ui/react\";import axios from\"axios\";import{useState,useContext}from\"react\";import ChatContext from\"../../Context/chat-context\";import UserBadgeItem from\"../userAvatar/UserBadgeItem\";import UserListItem from\"../userAvatar/UserListItem\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var UpdateGroupChatModal=function UpdateGroupChatModal(_ref){var fetchAgain=_ref.fetchAgain,setFetchAgain=_ref.setFetchAgain,fetchMessages=_ref.fetchMessages;var _useDisclosure=useDisclosure(),isOpen=_useDisclosure.isOpen,onOpen=_useDisclosure.onOpen,onClose=_useDisclosure.onClose;var _useState=useState(),_useState2=_slicedToArray(_useState,2),groupChatName=_useState2[0],setGroupChatName=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),search=_useState4[0],setSearch=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),searchResult=_useState6[0],setSearchResult=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),loading=_useState8[0],setLoading=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),renameLoading=_useState10[0],setRenameLoading=_useState10[1];var toast=useToast();var _useContext=useContext(ChatContext),selectedChat=_useContext.selectedChat,setSelectedChat=_useContext.setSelectedChat,user=_useContext.user;var handleSearch=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(query){var config,_yield$axios$get,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setSearch(query);if(query){_context.next=3;break;}return _context.abrupt(\"return\");case 3:_context.prev=3;setLoading(true);config={headers:{Authorization:\"Bearer \".concat(user.token)}};_context.next=8;return axios.get(\"/api/user?search=\".concat(search),config);case 8:_yield$axios$get=_context.sent;data=_yield$axios$get.data;console.log(data,'user search response');setLoading(false);setSearchResult(data);_context.next=20;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](3);console.log(_context.t0.message);toast({title:\"Error Occured!\",description:\"Failed to Load the Search Results\",status:\"error\",duration:3000,isClosable:true,position:\"bottom-left\"});setLoading(false);case 20:case\"end\":return _context.stop();}}},_callee,null,[[3,15]]);}));return function handleSearch(_x){return _ref2.apply(this,arguments);};}();var handleRename=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var config,_yield$axios$put,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(groupChatName){_context2.next=2;break;}return _context2.abrupt(\"return\");case 2:_context2.prev=2;setRenameLoading(true);config={headers:{Authorization:\"Bearer \".concat(user.token)}};_context2.next=7;return axios.put(\"/api/chat/rename\",{chatId:selectedChat._id,chatName:groupChatName//local state\n},config);case 7:_yield$axios$put=_context2.sent;data=_yield$axios$put.data;console.log(data._id,data,\"renaming group chat resposne\");// setSelectedChat(\"\");\nsetSelectedChat(data);setFetchAgain(!fetchAgain);//window.location.reload()\nsetRenameLoading(false);_context2.next=19;break;case 15:_context2.prev=15;_context2.t0=_context2[\"catch\"](2);toast({title:\"Error Occured!\",description:_context2.t0.response.data.message,status:\"error\",duration:3000,isClosable:true,position:\"bottom\"});setRenameLoading(false);case 19:setGroupChatName(\"\");//reseting the new name field \ncase 20:case\"end\":return _context2.stop();}}},_callee2,null,[[2,15]]);}));return function handleRename(){return _ref3.apply(this,arguments);};}();var handleAddUser=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(userToBeAdded){var config,_yield$axios$put2,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!selectedChat.users.find(function(existingUser){return existingUser._id===userToBeAdded._id;})){_context3.next=3;break;}toast({title:\"User Already in group!\",status:\"error\",duration:3000,isClosable:true,position:\"bottom\"});return _context3.abrupt(\"return\");case 3:if(!(selectedChat.groupAdmin._id!==user._id)){_context3.next=6;break;}//admin is not loggedIn user clause\ntoast({title:\"Only admins can add someone!\",status:\"error\",duration:3000,isClosable:true,position:\"bottom\"});return _context3.abrupt(\"return\");case 6:_context3.prev=6;setLoading(true);config={headers:{Authorization:\"Bearer \".concat(user.token)}};_context3.next=11;return axios.put(\"/api/chat/groupadd\",{chatId:selectedChat._id,userId:userToBeAdded._id},config);case 11:_yield$axios$put2=_context3.sent;data=_yield$axios$put2.data;setSelectedChat(data);console.log(data,'added user data response');setFetchAgain(!fetchAgain);setLoading(false);_context3.next=24;break;case 19:_context3.prev=19;_context3.t0=_context3[\"catch\"](6);console.log(_context3.t0.message);toast({title:\"Error Occured!\",description:_context3.t0.response.data.message,status:\"error\",duration:3000,isClosable:true,position:\"bottom\"});setLoading(false);case 24:setGroupChatName(\"\");case 25:case\"end\":return _context3.stop();}}},_callee3,null,[[6,19]]);}));return function handleAddUser(_x2){return _ref4.apply(this,arguments);};}();var handleRemove=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(userToBeRemoved){var config,_yield$axios$put3,data;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!(selectedChat.groupAdmin._id!==user._id&&userToBeRemoved._id!==user._id)){_context4.next=3;break;}toast({title:\"Only admins can remove someone!\",status:\"error\",duration:3000,isClosable:true,position:\"bottom\"});return _context4.abrupt(\"return\");case 3:_context4.prev=3;setLoading(true);config={headers:{Authorization:\"Bearer \".concat(user.token)}};_context4.next=8;return axios.put(\"/api/chat/groupremove\",{chatId:selectedChat._id,userId:userToBeRemoved._id},config);case 8:_yield$axios$put3=_context4.sent;data=_yield$axios$put3.data;userToBeRemoved._id===user._id?setSelectedChat():setSelectedChat(data);//leaveGroup clause //self UserBadgeItem cross\nsetFetchAgain(!fetchAgain);fetchMessages();//prop passsed down from singlechat //opt \nsetLoading(false);_context4.next=21;break;case 16:_context4.prev=16;_context4.t0=_context4[\"catch\"](3);console.log(_context4.t0.message);toast({title:\"Error Occured!\",description:_context4.t0.response.data.message,status:\"error\",duration:5000,isClosable:true,position:\"bottom\"});setLoading(false);case 21:setGroupChatName(\"\");case 22:case\"end\":return _context4.stop();}}},_callee4,null,[[3,16]]);}));return function handleRemove(_x3){return _ref5.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(IconButton,{d:{base:\"flex\"},icon:/*#__PURE__*/_jsx(ViewIcon,{}),onClick:onOpen}),/*#__PURE__*/_jsxs(Modal,{onClose:onClose,isOpen:isOpen,isCentered:true,children:[/*#__PURE__*/_jsx(ModalOverlay,{}),/*#__PURE__*/_jsxs(ModalContent,{children:[/*#__PURE__*/_jsx(ModalHeader,{fontSize:\"35px\",fontFamily:\"Work sans\",d:\"flex\",justifyContent:\"center\",children:selectedChat.chatName}),/*#__PURE__*/_jsx(ModalCloseButton,{}),/*#__PURE__*/_jsxs(ModalBody,{d:\"flex\",flexDir:\"column\",alignItems:\"center\",children:[/*#__PURE__*/_jsx(Box,{w:\"100%\",d:\"flex\",flexWrap:\"wrap\",pb:3,children:selectedChat.users.map(function(u){return/*#__PURE__*/_jsx(UserBadgeItem,{user:u,admin:selectedChat.groupAdmin,handleFunction:function handleFunction(){return handleRemove(u);}},u._id);})}),/*#__PURE__*/_jsxs(FormControl,{d:\"flex\",children:[/*#__PURE__*/_jsx(Input,{placeholder:\"Chat Name\",mb:3,value:groupChatName,onChange:function onChange(e){return setGroupChatName(e.target.value);}}),/*#__PURE__*/_jsx(Button,{variant:\"solid\",colorScheme:\"teal\",ml:1,isLoading:renameLoading,onClick:handleRename,children:\"Update\"})]}),/*#__PURE__*/_jsx(FormControl,{children:/*#__PURE__*/_jsx(Input,{placeholder:\"Add User to group\",mb:1,onChange:function onChange(e){return handleSearch(e.target.value);}})}),loading?/*#__PURE__*/_jsx(Spinner,{size:\"lg\"}):searchResult===null||searchResult===void 0?void 0:searchResult.map(function(selectedSearcheduser){return/*#__PURE__*/_jsx(UserListItem,{user:selectedSearcheduser,handleFunction:function handleFunction(){return handleAddUser(selectedSearcheduser);}},selectedSearcheduser._id);})]}),/*#__PURE__*/_jsx(ModalFooter,{children:/*#__PURE__*/_jsx(Button,{onClick:function onClick(){return handleRemove(user);},colorScheme:\"red\",children:\"Leave Group\"})})]})]})]});};export default UpdateGroupChatModal;","map":{"version":3,"sources":["/Users/shikharmishra/Documents/Mishra-Messenger/frontend/src/components/miscellaneous/UpdateGroupChatModal.js"],"names":["ViewIcon","Modal","ModalOverlay","ModalContent","ModalHeader","ModalFooter","ModalBody","ModalCloseButton","Button","useDisclosure","FormControl","Input","useToast","Box","IconButton","Spinner","axios","useState","useContext","ChatContext","UserBadgeItem","UserListItem","UpdateGroupChatModal","fetchAgain","setFetchAgain","fetchMessages","isOpen","onOpen","onClose","groupChatName","setGroupChatName","search","setSearch","searchResult","setSearchResult","loading","setLoading","renameLoading","setRenameLoading","toast","selectedChat","setSelectedChat","user","handleSearch","query","config","headers","Authorization","token","get","data","console","log","message","title","description","status","duration","isClosable","position","handleRename","put","chatId","_id","chatName","response","handleAddUser","userToBeAdded","users","find","existingUser","groupAdmin","userId","handleRemove","userToBeRemoved","base","map","u","e","target","value","selectedSearcheduser"],"mappings":"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","sourcesContent":["import { ViewIcon } from \"@chakra-ui/icons\";\nimport {\n  Modal,\n  ModalOverlay,\n  ModalContent,\n  ModalHeader,\n  ModalFooter,\n  ModalBody,\n  ModalCloseButton,\n  Button,\n  useDisclosure,\n  FormControl,\n  Input,\n  useToast,\n  Box,\n  IconButton,\n  Spinner,\n} from \"@chakra-ui/react\";\nimport axios from \"axios\";\nimport { useState, useContext } from \"react\";\nimport ChatContext from \"../../Context/chat-context\";\nimport UserBadgeItem from \"../userAvatar/UserBadgeItem\";\nimport UserListItem from \"../userAvatar/UserListItem\";\n\nconst UpdateGroupChatModal = ({  fetchAgain, setFetchAgain, fetchMessages }) => {\n\n  const { isOpen, onOpen, onClose } = useDisclosure();\n\n  const [groupChatName, setGroupChatName] = useState();\n  const [search, setSearch] = useState(\"\");\n  const [searchResult, setSearchResult] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [renameLoading, setRenameLoading] = useState(false);\n\n  const toast = useToast();\n\n  const { selectedChat, setSelectedChat, user } = useContext(ChatContext);\n\n\n  const handleSearch = async (query) => {\n\n    setSearch(query);\n    if (!query) {\n      return;\n    }\n\n    try {\n      setLoading(true);\n      const config = {\n        headers: { Authorization: `Bearer ${user.token}`}\n      };\n\n      const { data } = await axios.get(`/api/user?search=${search}`, config);\n\n      console.log(data, 'user search response');\n      setLoading(false);\n      setSearchResult(data);\n\n    } catch (error) {\n      \n      console.log(error.message)  \n      toast({\n        title: \"Error Occured!\",\n        description: \"Failed to Load the Search Results\",\n        status: \"error\",\n        duration: 3000,\n        isClosable: true,\n        position: \"bottom-left\",\n      });\n      setLoading(false);\n    }\n  };\n\n  const handleRename = async () => {\n    if (!groupChatName) return;\n\n    try {\n      setRenameLoading(true);\n      const config = { \n          headers: { Authorization: `Bearer ${user.token}`}\n        };\n\n      const { data } = await axios.put(\n        `/api/chat/rename`,\n        {\n          chatId: selectedChat._id,\n          chatName: groupChatName, //local state\n        },\n        config\n      );\n\n      console.log(data._id, data, \"renaming group chat resposne\");\n      // setSelectedChat(\"\");\n      setSelectedChat(data);\n      setFetchAgain(!fetchAgain); //window.location.reload()\n      setRenameLoading(false);\n\n    } catch (error) {\n      toast({\n        title: \"Error Occured!\",\n        description: error.response.data.message,\n        status: \"error\",\n        duration: 3000,\n        isClosable: true,\n        position: \"bottom\",\n      });\n      setRenameLoading(false);\n    }\n    setGroupChatName(\"\"); //reseting the new name field \n  };\n\n  const handleAddUser = async (userToBeAdded) => {\n\n    if (selectedChat.users.find((existingUser) => existingUser._id === userToBeAdded._id)) {\n      toast({\n        title: \"User Already in group!\",\n        status: \"error\",\n        duration: 3000,\n        isClosable: true,\n        position: \"bottom\",\n      });\n      return;\n    }\n\n    if (selectedChat.groupAdmin._id !== user._id) { //admin is not loggedIn user clause\n      toast({\n        title: \"Only admins can add someone!\",\n        status: \"error\",\n        duration: 3000,\n        isClosable: true,\n        position: \"bottom\",\n      });\n      return;\n    }\n\n    try {\n      setLoading(true);\n      const config = {\n        headers: { Authorization: `Bearer ${user.token}`},\n      };\n\n      const { data } = await axios.put(\n        `/api/chat/groupadd`,\n        {\n          chatId: selectedChat._id,\n          userId: userToBeAdded._id,\n        },\n        config\n      );\n\n      setSelectedChat(data);\n      console.log(data, 'added user data response');\n\n      setFetchAgain(!fetchAgain);\n      setLoading(false);\n\n    } catch (error) {\n\n      console.log(error.message);\n\n      toast({\n        title: \"Error Occured!\",\n        description: error.response.data.message,\n        status: \"error\",\n        duration: 3000,\n        isClosable: true,\n        position: \"bottom\",\n      });\n      setLoading(false);\n    }\n    setGroupChatName(\"\");\n  };\n\n  const handleRemove = async (userToBeRemoved) => {\n\n    if (selectedChat.groupAdmin._id !== user._id && userToBeRemoved._id !== user._id) {\n      toast({\n        title: \"Only admins can remove someone!\",\n        status: \"error\",\n        duration: 3000,\n        isClosable: true,\n        position: \"bottom\",\n      });\n      return;\n    }\n\n    try {\n      setLoading(true);\n      const config = {\n        headers: { Authorization: `Bearer ${user.token}` },\n      };\n\n      const { data } = await axios.put(\n        `/api/chat/groupremove`,\n        {\n          chatId: selectedChat._id,\n          userId: userToBeRemoved._id,\n        },\n        config\n      );\n\n      userToBeRemoved._id === user._id ? setSelectedChat() : setSelectedChat(data); \n      //leaveGroup clause //self UserBadgeItem cross\n\n      setFetchAgain(!fetchAgain);\n      fetchMessages(); //prop passsed down from singlechat //opt \n      setLoading(false);\n    } catch (error) {\n        \n      console.log(error.message);  \n      toast({\n        title: \"Error Occured!\",\n        description: error.response.data.message,\n        status: \"error\",\n        duration: 5000,\n        isClosable: true,\n        position: \"bottom\",\n      });\n      setLoading(false);\n    }\n    setGroupChatName(\"\");\n  };\n\n  return (\n    <>\n      <IconButton d={{ base: \"flex\" }} icon={<ViewIcon />} onClick={onOpen} />\n\n      <Modal onClose={onClose} isOpen={isOpen} isCentered>\n        <ModalOverlay />\n        <ModalContent>\n          <ModalHeader\n            fontSize=\"35px\"\n            fontFamily=\"Work sans\"\n            d=\"flex\"\n            justifyContent=\"center\"\n          >\n            {selectedChat.chatName}\n          </ModalHeader>\n\n          <ModalCloseButton />\n          <ModalBody d=\"flex\" flexDir=\"column\" alignItems=\"center\">\n            <Box w=\"100%\" d=\"flex\" flexWrap=\"wrap\" pb={3}>\n              {selectedChat.users.map((u) => (\n                <UserBadgeItem\n                  key={u._id}\n                  user={u}\n                  admin={selectedChat.groupAdmin}\n                  handleFunction={() => handleRemove(u)}\n                />\n              ))}\n            </Box>\n            <FormControl d=\"flex\">\n              <Input\n                placeholder=\"Chat Name\"\n                mb={3}\n                value={groupChatName}\n                onChange={(e) => setGroupChatName(e.target.value)}\n              />\n              <Button\n                variant=\"solid\"\n                colorScheme=\"teal\"\n                ml={1}\n                isLoading={renameLoading}\n                onClick={handleRename}\n              >\n                Update\n              </Button>\n            </FormControl>\n            <FormControl>\n              <Input\n                placeholder=\"Add User to group\"\n                mb={1}\n                onChange={(e) => handleSearch(e.target.value)}\n              />\n            </FormControl>\n\n            {loading ? (\n              <Spinner size=\"lg\" />\n            ) : (\n              searchResult?.map((selectedSearcheduser) => (\n                <UserListItem\n                  key={selectedSearcheduser._id}\n                  user={selectedSearcheduser}\n                  handleFunction={() => handleAddUser(selectedSearcheduser)}\n                />\n              ))\n            )}\n          </ModalBody>\n          <ModalFooter>\n            <Button onClick={() => handleRemove(user)} colorScheme=\"red\">\n              Leave Group\n            </Button>\n          </ModalFooter>\n        </ModalContent>\n      </Modal>\n    </>\n  );\n};\n\nexport default UpdateGroupChatModal;"]},"metadata":{},"sourceType":"module"}